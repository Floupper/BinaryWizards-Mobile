image: node:18
stages:
  - install
  - lint
  - test

cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/

install_dependencies:
  stage: install
  image: node:18
  script:
    - echo "Installing dependencies..."
    - npm install
  cache:
    key: ${CI_COMMIT_REF_SLUG}

lint:
  stage: lint
  script:
    - npx eslint src/*/*.js
    - npx htmlhint src/*/*.html
    - npx stylelint src/*/*
  artifacts:
        when: always
        paths:
            - lint.json
        reports:
            codequality: lint.json

test:
  script:
    - npm install
    - npm test
  artifacts:
      when: always
      reports:
          junit:
              - test-results.xml
      paths:
      - test-results.xml

build:
  image: docker
  needs:
    - test
  script:
    - docker build -t web-test .  